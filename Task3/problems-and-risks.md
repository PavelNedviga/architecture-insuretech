# Проблемы и риски при росте нагрузки

Контекст: core-app и ins-comp-settlement опрашивают ins-product-aggregator по REST, а settlement ещё и core-app — раз в сутки. Планируется +5 страховых компаний (итого 10).

## 1. Производительность и масштабирование

| № | Проблема | Риск при росте |
|---|----------|---------------|
| 1 | Синхронный fan-out вызов aggregator + 10 страховых API | *Линейный* рост RTT. Даже при 500 мс/компанию суммарно ≈5 сек почти гарантированно приведет к тайм-аутам |
| 2 | Локальные реплики + периодические запросы лишь частично решают проблему с ответами. Неуспешно обработанный запрос на ins-product-aggregator приводит к отставанию реплики от реальной ситуации | В совокупности с п.1 клиенты, обращаюшиеся за страховкой будут все чаще получать выдачу по нерелевантным продуктам с последующим отказом в оформлении. Поскольку реплика - зона ответственности компании, а не API партнеров, издержки несоответствий понесет InsureTech |
| 3 | 15-минутное и суточное опросы порождают «шквал» запросов в ins-product-aggregator | Пики CPU aggregator и БД; блокировка core-app. |

## 2. Надёжность

| № | Проблема | Что ломается |
|---|----------|--------------|
| 4 | Ошибки/тайм-ауты одного страховщика «держат» всю синхронную транзакцию | Core не получает список использует нерелевантные данные (локальные реплики), клиенты осуществляют заказы устаревших продуктов, отказ в оформлении при синхронизации в конце дня, падение NPS, продажи падают. |
| 5 | Settlement зависит от *двух* REST-запросов (aggregator и core-app). Любая ошибка ⇒ отчёт не сформирован | RTO > 8 ч → нарушение SLA со страховыми компаниями. |
| 6 | Retry-логика в каждом сервисе своя, что приведет к проблемам в поддержке актуального состояния реплик | Дублирование кода, разный backoff приведет «DDos» страховой системы на retry попытках обновления данных при текущей архитектуре |

## 3. Согласованность данных

| № | Проблема | Риск |
|---|----------|------|
| 7 | Локальные кэши продуктов невалидируются атомарно | Покупатель видит «уже недоступный» тариф и итоговый отказ в оформлении. |
| 8 | Settlement формирует выплаты из своего кэша (за предыдущий день) | Ошибка сумм премий, финансовые потери/штрафы. |

## 4. Будущее расширение

* +5 страховых ведет к росту времени ответа и количеству отказов
* Появятся внешние партнёры-агрегаторы, которым нужны будут live-обновления тарифов — REST-pull не масштабируется
